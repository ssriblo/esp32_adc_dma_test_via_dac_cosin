# ADC DMA Example
This is modified example from ESP-IDF esp-idf/examples/peripherals/adc/dma_read/

Speed increased up to 2000 Ksps. 

код взят отсюда:
https://github.com/espressif/esp-idf/tree/master/examples/peripherals/adc/dma_read
с небольшими изменениями,в частности, добавлено измерение времени и ограничено одним циклом DMA
Результаты:
TIMES=1024  sample_freq_hz= 2000000
TIME took 317 microseconds ret number= 1024
Т.е. DMA буфер размером 1024, частота DMA выбрана 2МГц, измеренное время от старта до получения данных равно 317 мкс. Не понятно, как может получиться такое время 317 мкс, если по расчетам получается 317/1024=0.315 мкс, т.е. 3 МГц. Требуется тест с живым сигналом, который надо оцифровать
Результат теста:
DAC генерирует 10КГц синус, т.е. 100мкс период
ADC выдал картинку с периодом 184 выборок, т.е. 184/100=1.84 Msps
Потом проверил на частоте DAC 20 KHz, 	получил адекватные результаты - 1.84 Msps

Расчет выше дает в два раза больший результат, так как не учтено, что буфер 1024, но там по два байта на слово и всего 512 выборок. Еще в измерении 317 мкс не учитывается задержка в функции приема, поэтому реальное время чуть меньше. 
Вывод - примерно сходится, по измерению с DAC получается1.84Msps, по измерению времени заполнения буфера получается (очень примерно) 512 /300 мкс = 1.7 Msps

Проблема - DAC выдает синус с уровнями от 0.9В до 2.2В, а ADC срезает все выше чем 1.4В (примерно). Видимо, надо настраивать входные уровни

Для того, чтобы плавно регулировать скорость выборок необходимо менять величину (строка 63)
uint32_t freq_khz = 2000;

Например, есть необходимость уменьшить частоту с 1.84МГц до 1.5МГц, это можно сделать меняя freq_khz. Точное значение подберем позднее

